# **Руководство по использованию библиотеки `discord-py`**
### *Здесь вы можете почитать об основах, которые необходимо понимать, чтобы грамотно работать с библиотекой и не задавать вопросов, касающихся самых базовых вещей*
___

Вероятнее всего у вас уже имеется созданный бот, поэтому инструкция по его созданию будет пропущена *(но, возмжно появится позже)*.

## Прежде чем начать...

Прежде чем приступать к работе с ботом, я сразу рекомендую зайти на страницу вашего бота и включить **намерения** (`intents`, [**подробнее**][4]). Для этого зайдите в [раздел приложений][1] и выберите вашего бота. Затем, слева, на вкладке **`"Bot"`**

[![Бот][2]][2] 

Включите параметры `PRESENCE INTENT` и `SERVER MEMBERS INTENT`

[![введите сюда описание изображения][3]][3]

Намерения нужны для работы с некоторыми событиями, объектами пользователей серверов (`участник`/`member`) и др. Они вам точно понадобятся, поэтому лучше включить их сразу, чтобы потом не спрашивать, почему вам не удается получить данные о пользователе сервера или чего-либо еще.

---

## Начало работы с ботом и `discord-py`

Бот, которого вы создали на странице [приложений][9], является аккаунтом дискорда, который по сути является таким же пользовательским аккаунтом, как и ваш, но с атрибутом `bot` и некоторыми ограничениями. Чтобы бот начал что-то делать, нужно создать его в коде и прописать логику.

Для начала рассмотрим виды ботов, которые предоставляет библиотека:

- [`discord.Client`][5] - фактически, самый базовый бот, на котором основаны другие. Умеет обрабатывать события по типу получения сообщений `on_message()`, установки реакции `on_raw_reaction_add()` и [другие][6].
- [`discord.ext.commands.Bot`][7] - тот же `discord.Client`, только умеет находить в сообщениях и обрабатывать отдельные команды, которые начинаются с какого-либо префикса, например `!test`
- [`discord.ext.commands.Cog`][8] - про этого бота ничего сказать не могу, так как ни разу не использовал. Насколько мне известно, он нужен в тех случаях, когда вы планируете задать боту кучу разных комманд, событий и организовать все это в один отдельный класс.

В общем-то, выбор бота зависит напрямую от цели использования. Если вам нужен простой бот, который будет читать чат, фильтровать мат и т.п., считывать реакции, выдавать роли при входе нового пользователя и т.д., то вам хватит базового бота [`discord.Client`][5].

Если помимо того, что я написал выше, вы хотите **добавить еще** и обработку команд по типу `!ban <@User>`, `!play <Ссылка на видео с YouTube>`, `!погода` и т.п., то использовать надо именно  [`discord.ext.commands.Bot`][7].

---

## Пишем код

Теперь, когда вы определились с ботом можно наконец-то приступить к написанию кода.

Для начала подключим библиотеку.
```py
import discord
```

**На данном этапе я настоятельно рекомендую ознакомиться с [руководством по использованию документации][10], так как на эту самую документацию я буду ссылаться очень часто и без ее использования вы вряд ли напишете что-то самостоятельно и будете постоянно спрашивать как реализовать ту или иную функцию.**

В случае, если вы хотите использовать [`discord.ext.commands.Bot`][7], я бы сразу отдельно добавил еще и этот класс
```py
from discord.ext import commands
```

### Инициализация бота

Теперь создадим объект бота, который будет обрабатывать события и команды:

Из [документации][7] видим, что единственным обязательным аргументом при создании экзампляра класса является `command_prefix`.

Он принимает строку (`str`), по которой бот будет определять, то что сообщение является командой и обрабатывать его нужно именно как команду.

Помимо этого, выдадим боту намерения (`intents`), инструкция по настройке которых была [в начале][11].

*В качестве префикса команды укажем `!`, намерения нужно выдавать именно те, которые вы будете использовать, но на первое время можно выдать все, то есть `discord.Intents.all()`*
**Если у вас `discord.ext.commands.Bot`:**
```
bot = commands.Bot(command_prefix='!', intents=discord.Intents.all())
```
**Если у вас `discord.Client`, то префикс указывать не нужно (класс не принимает такого аргумента):**
```
bot = discord.Client(intents=discord.Intents.all())
```

---

### Основные обработчики событий

Теперь у нас есть объект `bot`, для которого нужно написать логику взаимодействия. 

В качестве обработчиков событий используются асинхронные (`async`) функции (`def`), помеченные декоратором `@bot.event`, где `bot` - . Функция должна иметь название, строго как в документации -- иначе событие просто не будет обработано.



#### `async def on_ready()`

Первым делом, нужно удостовериться, что бот успешно запустился и готов к работе. В [списке событий][6] находим событие [`on_ready()`][12], которое вызывается **один раз** при запуске кода и обозначает то, что бот загрузился и готов к работе. 

Здесь нужно отметить, что в этой функции не следует размещать фрагменты кода, которые должны будут выполняться в дальнейшем, так как функция будет вызвана только один раз.
Поэтому в этой функции можно разместить какое-либо сообщение, о том, что бот запущен и, если есть работа с данными из файлов, то самое время их подгрузить. *В общем, выполнить все идиноразовые процедуры*.
---

### Запуск бота

Но перед этим его нужно запустить.

При помощи токена, который нужно скопировать на странице бота, в [разделе приложений][1] вы можете авторизоваться в аккаунте бота.

Бот будет выполнять работу до дех пор, пока вы не завершите выполнение кода. Это означает, что если вы закроете консольное окно программы, то бот перестанет 

---

[1]: https://discord.com/developers/applications
[2]: https://i.stack.imgur.com/ZnOYm.png
[3]: https://i.stack.imgur.com/HZCQP.png
[4]: https://discordpy.readthedocs.io/en/stable/intents.html
[5]: https://discordpy.readthedocs.io/en/stable/api.html?highlight=client#discord.Client
[6]: https://discordpy.readthedocs.io/en/stable/api.html?highlight=event#discord-api-events
[7]: https://discordpy.readthedocs.io/en/stable/ext/commands/api.html?highlight=bot#discord.ext.commands.Bot
[8]: https://discordpy.readthedocs.io/en/stable/ext/commands/api.html?highlight=cog#discord.ext.commands.Cog
[9]: https://discord.com/developers/applications
[10]: https://github.com/denisnumb/discord-py-guide/blob/main/using_docs.md#%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE-%D0%BF%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8E-%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%B0%D1%86%D0%B8%D0%B8-discord-py
[11]: https://github.com/denisnumb/discord-py-guide/blob/main/discord-py.md#%D0%BF%D1%80%D0%B5%D0%B6%D0%B4%D0%B5-%D1%87%D0%B5%D0%BC-%D0%BD%D0%B0%D1%87%D0%B0%D1%82%D1%8C
[12]: https://discordpy.readthedocs.io/en/stable/api.html?highlight=event#discord.on_ready
